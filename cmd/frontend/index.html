<!DOCTYPE html>

<head>
    <title>Different Point Sizes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        body,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 0;
            padding: 0;
            background: #e5e9f0;
        }

        ul {
            margin: 0;
            padding: 0;
            list-style-type: none;
        }

        /* li {
            border: 1px solid red;
        } */

        .nav>li {
            float: left;
            width: 20%;
        }

        .list-container {
            padding: 0 1rem;
        }

        .list-container li {
            margin: 0.25rem 0;
            padding-left: 5px;
        }

        .active {
            background: linear-gradient(90deg, #8fbcbb 0%, #88c0d0 35%, #5e81ac 100%);
        }
    </style>
</head>

<body style="margin: 1rem;">
    <div style="height: 70vh;">
        <canvas id="canvas" style="width: 100% !important;" class="chartjs-render-monitor"></canvas>
    </div>
    <ul class="nav">
        <li>
            <div id="classes-container" class="list-container">
                <h4>Classes</h4>
                <ul id="classes" onclick="onClassesClick(event)">
                </ul>
            </div>
        </li>
        <li>
            <div id="champions-container" class="list-container">
                <h4>Champions</h4>
                <ul id="champions" onclick="onChampionsClick(event)">
                </ul>
            </div>
        </li>
        <li>
            <div id="stat-container" class="list-container">
                <h4>Stat</h4>
                <ul id="stat" onclick="onStatsClick(event)">
                    <li id="stat-max" class="active">max</li>
                    <li id="stat-avg" class="active">avg</li>
                </ul>
            </div>
        </li>
    </ul>
    <script>
        toggleActiveClass = (classList) => classList.contains("active") ? classList.remove("active") : classList.add("active")
        toggleChart = champion => {
            const pointers = championToIndex[champion.textContent]
            if (champion.hidden || !champion.classList.contains("active")) {
                wrChart.data.datasets[pointers.max].hidden = true
                wrChart.data.datasets[pointers.avg].hidden = true
            } else if (champion.classList.contains("active")) {
                wrChart.data.datasets[pointers.max].hidden = !document.getElementById("stat-max").classList.contains("active")
                wrChart.data.datasets[pointers.avg].hidden = !document.getElementById("stat-avg").classList.contains("active")
            }
        }

        function onClassesClick(e) {
            if (e.target.tagName !== "LI" || !wrChart)
                return

            toggleActiveClass(e.target.classList)

            wrChart.update()
        }

        function onChampionsClick(e) {
            if (e.target.tagName !== "LI" || !wrChart)
                return

            toggleActiveClass(e.target.classList)
            toggleChart(e.target)

            wrChart.update()
        }

        function onStatsClick(e) {
            if (e.target.tagName !== "LI" || !wrChart)
                return

            toggleActiveClass(e.target.classList)
            for (champion of document.getElementById("champions").children) {
                toggleChart(champion)
            }

            wrChart.update()
        }

        var championData = {
            "Flanks": {
                "Buck": {
                    "2016-06-20T12:41:45.14Z": {
                        "avg": 45,
                        "max": 46,
                    },
                    "2016-06-21T12:41:45.14Z": {
                        "avg": 47,
                        "max": 48,
                    }
                },
                "Maeve": {
                    "2016-06-20T12:41:45.14Z": {
                        "avg": 49,
                        "max": 50,
                    },
                    "2016-06-21T12:41:45.14Z": {
                        "avg": 51,
                        "max": 52,
                    }
                }
            },
            "Tanks": {
                "Raum": {
                    "2016-06-20T12:41:45.14Z": {
                        "avg": 53,
                        "max": 54,
                    },
                    "2016-06-21T12:41:45.14Z": {
                        "avg": 55,
                        "max": 56,
                    }
                },
                "Barik": {
                    "2016-06-20T12:41:45.14Z": {
                        "avg": 57,
                        "max": 58,
                    },
                    "2016-06-21T12:41:45.14Z": {
                        "avg": 59,
                        "max": 60,
                    }
                }
            },
        }



        var classChampionIndex = Object.keys(championData).map(className => ({ [className]: [] })).reduce((acc, sing) => Object.assign(acc, sing))
        var championToIndex = {}
        var statToIndex = { max: [], avg: [] }

        window.onload = function () {
            let config = {
                type: 'line',
                data: {
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        position: 'bottom',
                    },
                    hover: {
                        mode: 'index'
                    },
                },
            }

            for (className in championData) {
                { // create class list entry
                    let championClassListItem = document.createElement("li")
                    championClassListItem.classList.add("active")
                    championClassListItem.appendChild(document.createTextNode(className))

                    document.getElementById("classes").appendChild(championClassListItem)
                }

                for (championName in championData[className]) {
                    { // create champion list entry
                        let championsListItem = document.createElement("li")
                        championsListItem.classList.add("active")
                        championsListItem.appendChild(document.createTextNode(championName))

                        document.getElementById("champions").appendChild(championsListItem)
                    }


                    championToIndex[championName] = { max: config.data.datasets.length, avg: config.data.datasets.length + 1 }
                    statToIndex.max.push(config.data.datasets.length)
                    statToIndex.avg.push(config.data.datasets.length + 1)


                    { // chart.js datasets
                        config.data.datasets.push({
                            label: `${championName} - max`,
                            data: Object.keys(championData[className][championName]).map(datapointTS => (
                                {
                                    x: Date.parse(datapointTS),
                                    y: championData[className][championName][datapointTS].max,
                                })),
                            fill: false,
                            pointHoverRadius: 10,
                        })
                        config.data.datasets.push({
                            label: `${championName} - avg`,
                            data: Object.keys(championData[className][championName]).map(datapointTS => (
                                {
                                    x: Date.parse(datapointTS),
                                    y: championData[className][championName][datapointTS].avg,
                                })),
                            fill: false,
                            pointHoverRadius: 10,
                        })
                    }
                }
            }

            const ctx = document.getElementById('canvas').getContext('2d');
            window.wrChart = new Chart(ctx, config);
        };
    </script>



</body>